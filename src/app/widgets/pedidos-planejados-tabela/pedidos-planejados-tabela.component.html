<h2 class="display-6">Pedidos planejados</h2>

<p-table #dt [value]="pedidoStore.item()||[]" dataKey="pedido.id"
         [tableStyle]="{ 'min-width': '60rem' }"
         [expandedRowKeys]="expandedRows"
         [paginator]="true"
         [rowsPerPageOptions]="[5,20,30]"
         [rows]="5">

    <!-- Table Header -->
    <ng-template #header>
        <tr>
            <th></th>

            <th pSortableColumn="pedido.id">
                ID
                <p-sortIcon field="pedido.id"></p-sortIcon>
            </th>

            <th pSortableColumn="pedido.codigo">
                C√≥digo
                <p-sortIcon field="pedido.codigo"></p-sortIcon>
            </th>

            <th pSortableColumn="pedido.lote">
                Lote
                <p-sortIcon field="pedido.lote"></p-sortIcon>
            </th>

            <th pSortableColumn="pedido.dataEntrega">
                Data
                <p-sortIcon field="pedido.dataEntrega"></p-sortIcon>
            </th>

            <th pSortableColumn="pedido.item.Item">
                Item
                <p-sortIcon field="pedido.item.Item"></p-sortIcon>
            </th>

            <th pSortableColumn="pedido.item.tipo_item">
                Tipo Item
                <p-sortIcon field="pedido.item.tipo_item"></p-sortIcon>
            </th>

            @if(isEditable()){<th></th>}

            <th>Status</th>
        </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template #body let-product let-expanded="expanded">
        <tr>
            <td>
                <p-button type="button" pRipple [pRowToggler]="product" [text]="true" severity="secondary"
                          [rounded]="true"
                          [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></p-button>
            </td>

            <td>{{ product.pedido.id }}</td>
            <td>{{ product.pedido.codigo }}</td>
            <td>{{ product.pedido.lote }}</td>
            <td>{{ product.pedido.dataEntrega | date:'dd/MM/yyyy':'UTC' }}</td>
            <td>{{ product.pedido.item.Item }}</td>
            <td>{{ product.pedido.item.tipo_item }}</td>

            @if(isEditable()){<td>
                <button class="btn btn-group btn-outline-secondary border-0"
                        (click)="replanejarPedido(product.pedido.id)"
                        >
                    <i class="pi pi-refresh"></i>
                </button>
            </td>}

            <td>
                <p-tag *ngIf="product.atrasos.length" severity="warn">A</p-tag>
                <p-tag *ngIf="product.dividas.length" severity="danger">D</p-tag>
                <p-tag *ngIf="!product.atrasos.length && !product.dividas.length" severity="success">OK</p-tag>
            </td>
        </tr>
    </ng-template>

    <!-- Expanded Row Template -->
    <ng-template #expandedrow let-product>
        <tr>
            <td colspan="8">
                <div class="p-4">

                    <!-- D√≠vidas -->
                    <h5>üìå D√≠vidas do {{ product.pedido.item.tipo_item }}</h5>
                    <p-table [value]="product.dividas" dataKey="id" class="mb-4">
                        <ng-template #header>
                            <tr>
                                <th>Setor</th>
                                <th>Item</th>
                                <th>Tipo Item</th>
                                <th>Qtd</th>
                            </tr>
                        </ng-template>
                        <ng-template #body let-divida>
                            <tr>
                                <td>{{ divida.setorCodigo }}</td>
                                <td>{{ divida.item.Item }}</td>
                                <td>{{ divida.item.tipo_item }}</td>
                                <td>{{ divida.qtd }}</td>
                            </tr>
                        </ng-template>
                        <ng-template #emptymessage>
                            <tr>
                                <td colspan="4">N√£o tem d√≠vidas.</td>
                            </tr>
                        </ng-template>
                    </p-table>

                    <!-- Atrasos -->
                    <h5>‚è≥ Atrasos do {{ product.pedido.item.tipo_item }}</h5>
                    <p-table [value]="product.atrasos" dataKey="id">
                        <ng-template #header>
                            <tr>
                                <th>Setor</th>
                                <th>Item</th>
                                <th>Tipo Item</th>
                                <th>Qtd</th>
                            </tr>
                        </ng-template>
                        <ng-template #body let-atraso>
                            <tr>
                                <td>{{ atraso.setorCodigo }}</td>
                                <td>{{ atraso.item.Item }}</td>
                                <td>{{ atraso.item.tipo_item }}</td>
                                <td>{{ atraso.qtd }}</td>
                            </tr>
                        </ng-template>
                        <ng-template #emptymessage>
                            <tr>
                                <td colspan="4">N√£o tem atrasos.</td>
                            </tr>
                        </ng-template>
                    </p-table>

                </div>
            </td>
        </tr>
    </ng-template>

</p-table>
